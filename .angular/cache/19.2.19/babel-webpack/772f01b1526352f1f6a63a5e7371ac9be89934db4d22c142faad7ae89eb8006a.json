{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nfunction FileUploadAngularComponent_div_0_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function FileUploadAngularComponent_div_0_button_4_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.openCloseFilesDialog(true));\n    });\n    i0.ɵɵtext(1, \" Check Selected Files \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FileUploadAngularComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"input\", 1);\n    i0.ɵɵlistener(\"change\", function FileUploadAngularComponent_div_0_Template_input_change_1_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onChange($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function FileUploadAngularComponent_div_0_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.triggerFilesControl());\n    });\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, FileUploadAngularComponent_div_0_button_4_Template, 2, 0, \"button\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"multiple\", ctx_r1.multiple);\n    i0.ɵɵattribute(\"id\", ctx_r1.divId)(\"name\", \"files[]\")(\"accept\", ctx_r1.config.formatsAllowed);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.buttonText, \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.allowedFiles && ctx_r1.allowedFiles.length > 0 || ctx_r1.notAllowedFiles && ctx_r1.notAllowedFiles.length > 0);\n  }\n}\nfunction FileUploadAngularComponent_div_1_div_3_tr_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"input\", 15);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function FileUploadAngularComponent_div_1_div_3_tr_15_Template_input_ngModelChange_6_listener($event) {\n      const validFile_r7 = i0.ɵɵrestoreView(_r6).$implicit;\n      i0.ɵɵtwoWayBindingSet(validFile_r7.selected, $event) || (validFile_r7.selected = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const validFile_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(validFile_r7.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", validFile_r7.fileSize, \" MB\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", validFile_r7.selected);\n  }\n}\nfunction FileUploadAngularComponent_div_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"span\", 11);\n    i0.ɵɵtext(2, \"Valid Files\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 12)(4, \"thead\")(5, \"tr\")(6, \"th\", 13);\n    i0.ɵɵtext(7, \"Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\", 13);\n    i0.ɵɵtext(9, \"File Size\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\", 13)(11, \"label\", 14);\n    i0.ɵɵtext(12, \" Select All \");\n    i0.ɵɵelementStart(13, \"input\", 15);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function FileUploadAngularComponent_div_1_div_3_Template_input_ngModelChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectAll, $event) || (ctx_r1.selectAll = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function FileUploadAngularComponent_div_1_div_3_Template_input_ngModelChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.selectedAll($event));\n    });\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, FileUploadAngularComponent_div_1_div_3_tr_15_Template, 7, 3, \"tr\", 16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectAll);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.allowedFiles);\n  }\n}\nfunction FileUploadAngularComponent_div_1_div_4_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const invalidFile_r8 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(invalidFile_r8.fileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", invalidFile_r8.fileSize, \" MB\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(invalidFile_r8.errorMsg);\n  }\n}\nfunction FileUploadAngularComponent_div_1_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"span\", 11);\n    i0.ɵɵtext(2, \"Invalid Files\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"table\", 12)(4, \"thead\")(5, \"tr\")(6, \"th\", 13);\n    i0.ɵɵtext(7, \"Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\", 13);\n    i0.ɵɵtext(9, \"File Size\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\", 13);\n    i0.ɵɵtext(11, \"Error\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"tbody\");\n    i0.ɵɵtemplate(13, FileUploadAngularComponent_div_1_div_4_tr_13_Template, 7, 3, \"tr\", 16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.notAllowedFiles);\n  }\n}\nfunction FileUploadAngularComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 5)(2, \"div\", 6);\n    i0.ɵɵtemplate(3, FileUploadAngularComponent_div_1_div_3_Template, 16, 2, \"div\", 7)(4, FileUploadAngularComponent_div_1_div_4_Template, 14, 1, \"div\", 7);\n    i0.ɵɵelementStart(5, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function FileUploadAngularComponent_div_1_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openCloseFilesDialog(false));\n    });\n    i0.ɵɵtext(6, \" Close \");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(7, \"div\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.allowedFiles && ctx_r1.allowedFiles.length > 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.notAllowedFiles && ctx_r1.notAllowedFiles.length > 0);\n  }\n}\nexport let FileUploadAngularComponent = /*#__PURE__*/(() => {\n  class FileUploadAngularComponent {\n    constructor() {\n      this.divId = '';\n      this.multiple = false;\n      this.config = {};\n      this.buttonText = 'Select Files';\n      this.fileUploadEmitter = new EventEmitter();\n      this.filesEmitter = new EventEmitter();\n      this.allowedFiles = [];\n      this.notAllowedFiles = [];\n      this.filesDialog = false;\n      this.selectAll = true;\n    }\n    ngOnInit() {\n      this.divId = this.generateDynamicString(8);\n    }\n    /**\n     * open/close files selection dialog\n     * @param val boolean\n     */\n    openCloseFilesDialog(val) {\n      this.filesDialog = val;\n      if (!val) {\n        this.filesEmitter.emit({\n          validFiles: this.filterSelectedFiles(),\n          invalidFiles: this.notAllowedFiles\n        });\n      }\n    }\n    /**\n     * return selected files list\n     */\n    filterSelectedFiles() {\n      return this.allowedFiles.filter(e => e.selected === true);\n    }\n    /**\n     * select/unselect all checkboxes\n     * @param data object\n     */\n    selectedAll(data) {\n      if (this.allowedFiles && this.allowedFiles.length > 0) {\n        this.allowedFiles.forEach(e => {\n          e.selected = data;\n        });\n      }\n    }\n    /**\n     * remove valid files\n     * @param index number\n     */\n    removeValidFiles(index) {\n      if (index > -1) {\n        this.allowedFiles.splice(index, 1);\n      }\n      this.filesEmitter.emit({\n        validFiles: this.filterSelectedFiles(),\n        invalidFiles: this.notAllowedFiles\n      });\n    }\n    /**\n     * remove file from invalid files\n     * @param index number\n     */\n    removeInvalidFiles(index) {\n      if (index > -1) {\n        this.notAllowedFiles.splice(index, 1);\n      }\n      this.filesEmitter.emit({\n        validFiles: this.filterSelectedFiles(),\n        invalidFiles: this.notAllowedFiles\n      });\n    }\n    /**\n     * trigger input type file control on button click\n     */\n    triggerFilesControl() {\n      const element = document.getElementById(this.divId);\n      if (element) {\n        element.click();\n      }\n    }\n    /**\n     * generate random string as per passed number length\n     * @param length number\n     */\n    generateDynamicString(length) {\n      let result = '';\n      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n      const charactersLength = characters.length;\n      for (let i = 0; i < length; i++) {\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\n      }\n      return result;\n    }\n    /**\n     * reset valid/invalid files property\n     */\n    resetFiles() {\n      this.allowedFiles = [];\n      this.notAllowedFiles = [];\n      this.filesEmitter.emit({\n        validFiles: this.allowedFiles,\n        invalidFiles: this.notAllowedFiles\n      });\n    }\n    convertSize(fileSize) {\n      //   return fileSize < 1024000\n      //     ? (fileSize / 1024).toFixed(2) + \" KB\"\n      //     : (fileSize / 1024000).toFixed(2) + \" MB\";\n      return (fileSize / 1024000).toFixed(2);\n    }\n    /**\n     * trigger when user select files using file control\n     * @param event object\n     */\n    onChange(event) {\n      this.notAllowedFiles = [];\n      let fileList;\n      this.allowedFiles = [];\n      if (event.type === 'drop') {\n        fileList = event.dataTransfer.files;\n      } else {\n        fileList = event.target.files || event.srcElement.files;\n      }\n      for (let i = 0; i < fileList.length; i++) {\n        // const currentFileExt = fileExtRegExp.exec(fileList[i].name)[1].toLowerCase(); // Get file extension.\n        const currentFileName = fileList[i].name.split('.');\n        let currentFileExt = '';\n        if (currentFileName && currentFileName.length > 0) {\n          currentFileExt = currentFileName[currentFileName.length - 1];\n        }\n        const isFormatValid = this.config.formatsAllowed ? this.config.formatsAllowed.includes(currentFileExt) : true;\n        const fSize = this.convertSize(fileList[i].size);\n        const isSizeValid = fSize <= this.config.maxSize;\n        // Check whether current file format and size is correct as specified in the configurations.\n        if (isFormatValid && isSizeValid) {\n          const currentFile = fileList[i];\n          currentFile['fileSize'] = this.convertSize(fileList[i].size);\n          currentFile['selected'] = true;\n          this.allowedFiles.push(fileList[i]);\n        } else {\n          this.notAllowedFiles.push({\n            fileName: fileList[i].name,\n            fileSize: this.convertSize(fileList[i].size),\n            errorMsg: !isFormatValid ? 'Invalid format' : 'Invalid size'\n          });\n        }\n      }\n      this.filesEmitter.emit({\n        validFiles: this.allowedFiles,\n        invalidFiles: this.notAllowedFiles\n      });\n    }\n    /**\n     * create files data to upload to API\n     */\n    createFormData() {\n      const formData = new FormData();\n      const validFiles = this.filterSelectedFiles();\n      for (let i = 0; i < validFiles.length; i++) {\n        formData.append('files', validFiles[i]);\n      }\n      return formData;\n    }\n    /**\n     * service call\n     */\n    fileUpload() {\n      const formData = this.createFormData();\n      fetch(this.config.uploadConfig.url, {\n        method: this.config.uploadConfig.method,\n        body: formData,\n        headers: {\n          'Content-Type': 'application/json',\n          Bearer: this.config.uploadConfig.userRef\n        }\n      }).then(response => response.json()).then(result => {\n        this.fileUploadEmitter.emit({\n          success: true,\n          response: result\n        });\n      }).catch(error => {\n        // this.$emit(\"fileUploadEmitter\", { success: false, response: error });\n        this.fileUploadEmitter.emit({\n          success: false,\n          response: error\n        });\n      });\n    }\n    static {\n      this.ɵfac = function FileUploadAngularComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || FileUploadAngularComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: FileUploadAngularComponent,\n        selectors: [[\"lib-file-upload\"]],\n        inputs: {\n          multiple: \"multiple\",\n          config: \"config\",\n          buttonText: \"buttonText\"\n        },\n        outputs: {\n          fileUploadEmitter: \"fileUploadEmitter\",\n          filesEmitter: \"filesEmitter\"\n        },\n        decls: 2,\n        vars: 2,\n        consts: [[4, \"ngIf\"], [\"type\", \"file\", 2, \"display\", \"none\", 3, \"change\", \"multiple\"], [1, \"btn\", \"btn-primary\", \"btn-sm\", \"afu-select-btn\", 3, \"click\"], [\"class\", \"btn btn-primary btn-sm afu-select-btn customClass ml-1\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", \"btn-sm\", \"afu-select-btn\", \"customClass\", \"ml-1\", 3, \"click\"], [1, \"jw-modal\"], [1, \"jw-modal-body\"], [\"class\", \"files-container\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", \"btn-sm\", \"afu-select-btn\", \"customClass\", 3, \"click\"], [1, \"jw-modal-background\"], [1, \"files-container\"], [1, \"file-type\"], [1, \"table\", \"table-striped\", \"table-bordered\", \"table-hover\", \"table-sm\"], [\"scope\", \"col\"], [1, \"selectall\"], [\"type\", \"checkbox\", \"name\", \"'test\", 3, \"ngModelChange\", \"ngModel\"], [4, \"ngFor\", \"ngForOf\"]],\n        template: function FileUploadAngularComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, FileUploadAngularComponent_div_0_Template, 5, 6, \"div\", 0)(1, FileUploadAngularComponent_div_1_Template, 8, 2, \"div\", 0);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.config);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.filesDialog === true);\n          }\n        },\n        dependencies: [i1.NgForOf, i1.NgIf, i2.CheckboxControlValueAccessor, i2.NgControlStatus, i2.NgModel],\n        styles: [\".jw-modal[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:1000;overflow:auto}.jw-modal-body[_ngcontent-%COMP%]{padding:20px;background:#fff;margin:40px;height:400px;overflow-y:scroll}.jw-modal-background[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000;opacity:.75;z-index:900}body.jw-modal-open[_ngcontent-%COMP%]{overflow:hidden}.file-type[_ngcontent-%COMP%]{font-weight:700}.files-container[_ngcontent-%COMP%]{margin-bottom:10px}.selectall[_ngcontent-%COMP%]{display:block}\"]\n      });\n    }\n  }\n  return FileUploadAngularComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}